{"version":3,"sources":["../../server/common/dao.js"],"names":["Dao","db","update","id","object","table","args","keys","Object","length","Promise","resolve","query","count","forEach","key","push","insert","data","reject","one","then","catch","console","log","error","require","module","exports"],"mappings":";;AAAA;;;;IAEMA,G,GACJ,aAAYC,EAAZ,EAAgB;AAAA;;AAAA;;AAAA,OAIhBC,MAJgB,GAIP,UAACC,EAAD,EAAKC,MAAL,EAAaC,KAAb,EAAuB;AAC9B,QAAIC,OAAO,EAAX;;AAEA,QAAIC,OAAOC,OAAOD,IAAP,CAAYH,MAAZ,CAAX;;AAEA,QAAI,CAACG,KAAKE,MAAV,EAAkB;AAChB,aAAOC,QAAQC,OAAR,CAAgBP,MAAhB,CAAP;AACD;AACD,QAAIQ,oBAAkBP,KAAlB,UAAJ;AACA,QAAIQ,QAAQ,CAAZ;;AAEAN,SAAKO,OAAL,CAAa,eAAO;AAClBF,eAAY,uBAAUG,GAAV,CAAZ,UAA+BF,KAA/B;AACAP,WAAKU,IAAL,CAAUZ,OAAOW,GAAP,CAAV;AACAF;AACD,KAJD;;AAMAP,SAAKU,IAAL,CAAUb,EAAV;;AAEAS,0CAAoCC,KAApC;AACA,WAAO,MAAKI,MAAL,CAAYL,KAAZ,EAAmBN,IAAnB,CAAP;AACD,GAzBe;;AAAA,OA2BhBW,MA3BgB,GA2BP,UAACL,KAAD,EAAQM,IAAR,EAAiB;AACxB,WAAO,IAAIR,OAAJ,CAAY,UAACC,OAAD,EAAUQ,MAAV,EAAqB;AACtC,YAAKlB,EAAL,CAAQmB,GAAR,CAAYR,KAAZ,EAAmBM,IAAnB,EACWG,IADX,CACgB,gBAAQ;AACZV,gBAAQO,IAAR;AACD,OAHX,EAIWI,KAJX,CAIiB,iBAAS;AACdC,gBAAQC,GAAR,CAAY,OAAZ,EAAqBC,KAArB;AACAN,eAAOM,KAAP;AACA,eAAOA,KAAP;AACD,OARX;AASD,KAVM,CAAP;AAWD,GAvCe;;AACd,OAAKxB,EAAL,GAAUA,MAAMyB,QAAQ,qBAAR,EAA+BzB,EAA/C;AACD,C;;AAyCH0B,OAAOC,OAAP,GAAiB5B,GAAjB","file":"dao.js","sourcesContent":["import {snakeCase} from 'lodash';\n\nclass Dao {\n  constructor(db) {\n    this.db = db || require('../lib/dbConnection').db;\n  }\n\n  update = (id, object, table) => {\n    let args = [];\n\n    let keys = Object.keys(object);\n\n    if (!keys.length) {\n      return Promise.resolve(object);\n    }\n    let query = `UPDATE ${table} SET `;\n    let count = 1;\n\n    keys.forEach(key => {\n      query += `${snakeCase(key)}=$${count}, `;\n      args.push(object[key]);\n      count++;\n    });\n\n    args.push(id);\n\n    query += `updated=now() WHERE id=$${count} returning id;`;\n    return this.insert(query, args);\n  }\n\n  insert = (query, data) => {\n    return new Promise((resolve, reject) => {\n      this.db.one(query, data)\n                .then(data => {\n                  resolve(data);\n                })\n                .catch(error => {\n                  console.log('error', error);\n                  reject(error);\n                  return error;\n                });\n    });\n  }\n\n}\n\nmodule.exports = Dao;\n\n"]}