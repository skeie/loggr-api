{"version":3,"sources":["../../server/users/userService.js"],"names":["jwtToken","require","Service","dao","commonDao","getUserById","userId","createUser","getUserWithEmail","user","email","then","Boolean","ourUser","highscoreService","create","id","generateToken","userDAO","CommonDao","HighscoreService"],"mappings":";;;;;;;;;;AAAA,IAAMA,WAAWC,QAAQ,kBAAR,CAAjB;;IAEqBC,O,GACnB,iBAAYC,GAAZ,EAAiBC,SAAjB,EAA4B;AAAA;;AAAA;;AAAA,OAS5BC,WAT4B,GASd,kBAAU;AACtB,WAAO,MAAKF,GAAL,CAASE,WAAT,CAAqBC,MAArB,CAAP;AACD,GAX2B;;AAAA,OAa5BC,UAb4B,GAaf,gBAAQ;AACnB,WAAO,MAAKJ,GAAL,CAASK,gBAAT,CAA0BC,KAAKC,KAA/B,EAAsCC,IAAtC,CAA2C,mBAAW;AAC3D,UAAIC,QAAQC,OAAR,CAAJ,EAAsB;AACpB,cAAKC,gBAAL,CAAsBC,MAAtB,CAA6BF,QAAQG,EAArC,EAAyC,IAAzC,EADoB,CAC4B;AAChD,4BAAYH,OAAZ,IAAqBb,UAAUA,SAASiB,aAAT,CAAuBJ,OAAvB,CAA/B;AACD,OAHD,MAGO;AACL,eAAO,MAAKV,GAAL,CAASI,UAAT,CAAoBE,IAApB,EAA0BE,IAA1B,CAA+B,cAAM;AAC1C,gBAAKG,gBAAL,CAAsBC,MAAtB,CAA6BC,EAA7B;AACA,8BACKP,IADL;AAEEO,kBAFF;AAGEhB,sBAAUA,SAASiB,aAAT,cAA4BR,IAA5B,IAAkCO,MAAlC;AAHZ;AAKD,SAPM,CAAP;AAQD;AACF,KAdM,CAAP;AAeD,GA7B2B;;AAC1B,MAAME,UAAUf,OAAOF,QAAQ,WAAR,CAAvB;AACA,MAAMkB,YAAYf,aAAaH,QAAQ,eAAR,CAA/B;AACA,MAAMmB,mBAAmBnB,QAAQ,+BAAR,CAAzB;AACA,OAAKa,gBAAL,GAAwB,IAAIM,gBAAJ,EAAxB;AACA,OAAKjB,GAAL,GAAW,IAAIe,OAAJ,EAAX;AACA,OAAKd,SAAL,GAAiB,IAAIe,SAAJ,EAAjB;AACD,C;;kBARkBjB,O","file":"userService.js","sourcesContent":["const jwtToken = require(\"../util/jwtToken\");\n\nexport default class Service {\n  constructor(dao, commonDao) {\n    const userDAO = dao || require(\"./userDAO\");\n    const CommonDao = commonDao || require(\"../common/dao\");\n    const HighscoreService = require(\"../highscore/highscoreService\");\n    this.highscoreService = new HighscoreService();\n    this.dao = new userDAO();\n    this.commonDao = new CommonDao();\n  }\n\n  getUserById = userId => {\n    return this.dao.getUserById(userId);\n  }\n\n  createUser = user => {\n    return this.dao.getUserWithEmail(user.email).then(ourUser => {\n      if (Boolean(ourUser)) {\n        this.highscoreService.create(ourUser.id, true); //legazy, remove me\n        return { ...ourUser, jwtToken: jwtToken.generateToken(ourUser) };\n      } else {\n        return this.dao.createUser(user).then(id => {\n          this.highscoreService.create(id);\n          return {\n            ...user,\n            id,\n            jwtToken: jwtToken.generateToken({ ...user, id })\n          };\n        });\n      }\n    });\n  };\n}\n"]}